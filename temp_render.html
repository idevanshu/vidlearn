<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>p5.js Animation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ccapture.js@1.1.0/build/CCapture.all.min.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
        width: 100%;
        height: 100%;
      }

      canvas {
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <script>
      let targetValue = 63;
let sortedArray = [];
let labels = [];
let leftIndex = 0;
let rightIndex = 0;
let midIndex = 0;
let animationState = "initializing"; // states: initializing, searching, found, notFound
let animationStartTime = 0;
let animationDuration = 5000; // 5 seconds
let message = "";
let highlightAlpha = 0;
let pulseValue = 0;
let arrowY = 0;

function setup() {
  createCanvas(800, 600);
  
  // Create sorted array of numbers
  for (let i = 0; i <= 100; i += 5) {
    sortedArray.push(i);
    labels.push(i.toString());
  }
  
  leftIndex = 0;
  rightIndex = sortedArray.length - 1;
  
  animationState = "searching";
  animationStartTime = millis();
}

function draw() {
  background(0);
  
  // Calculate animation progress
  let progress = (millis() - animationStartTime) / animationDuration;
  progress = constrain(progress, 0, 1);
  
  // Update pulse animation
  pulseValue = sin(frameCount * 0.1) * 10;
  
  drawTitle();
  drawArray();
  
  if (animationState === "searching") {
    updateSearch(progress);
  } else if (animationState === "found") {
    drawFoundMessage();
  } else if (animationState === "notFound") {
    drawNotFoundMessage();
  }
  
  // Stop after full duration
  if (progress >= 1 && animationState === "searching") {
    animationState = "notFound";
  }
}

function drawTitle() {
  fill(255);
  textSize(32);
  textAlign(CENTER, TOP);
  text("Binary Search Animation", width/2, 40);
  
  textSize(18);
  text("Target Value: " + targetValue, width/2, 90);
}

function drawArray() {
  let boxWidth = 50;
  let boxHeight = 40;
  let startX = width/2 - (sortedArray.length * boxWidth)/2;
  let startY = height/2 - 50;
  
  // Draw array boxes
  for (let i = 0; i < sortedArray.length; i++) {
    let x = startX + i * boxWidth;
    let y = startY;
    
    // Determine if this box is in the current search range
    let inRange = (i >= leftIndex && i <= rightIndex);
    let isMid = (i === midIndex && animationState === "searching");
    
    // Box styling
    stroke(255);
    strokeWeight(1);
    
    if (isMid) {
      // Mid index with pulsing effect
      fill(100, 150, 255, 150 + pulseValue);
      strokeWeight(3);
    } else if (inRange) {
      // Current range
      fill(70, 70, 150, 150);
    } else {
      // Outside current range
      fill(30, 30, 30, 150);
    }
    
    // Draw the box
    rect(x, y, boxWidth, boxHeight);
    
    // Draw the number
    fill(255);
    textSize(16);
    textAlign(CENTER, CENTER);
    text(sortedArray[i], x + boxWidth/2, y + boxHeight/2);
    
    // Add index labels below
    textSize(12);
    text(i, x + boxWidth/2, y + boxHeight + 20);
  }
  
  // Add labels for left, right, and mid pointers
  drawPointer(startX + leftIndex * boxWidth + boxWidth/2, startY + boxHeight + 40, "left", color(0, 255, 0));
  drawPointer(startX + rightIndex * boxWidth + boxWidth/2, startY + boxHeight + 40, "right", color(255, 0, 0));
  
  if (animationState === "searching") {
    drawPointer(startX + midIndex * boxWidth + boxWidth/2, startY + boxHeight + 40, "mid", color(255, 255, 0));
  }
  
  // Draw current status
  fill(255);
  textSize(20);
  textAlign(CENTER);
  text(message, width/2, height - 100);
}

function drawPointer(x, y, label, pointerColor) {
  fill(pointerColor);
  textSize(14);
  textAlign(CENTER);
  text(label, x, y);
  
  // Triangle pointer
  triangle(x - 8, y + 10, x + 8, y + 10, x, y + 20);
}

function updateSearch(progress) {
  // Map progress to specific search steps (3 iterations)
  let step;
  
  if (progress < 0.33) {
    step = 0;
  } else if (progress < 0.67) {
    step = 1;
  } else {
    step = 2;
  }
  
  // Perform binary search steps
  if (step === 0) {
    leftIndex = 0;
    rightIndex = sortedArray.length - 1;
    midIndex = Math.floor((leftIndex + rightIndex) / 2);
    message = "Checking if " + sortedArray[midIndex] + " equals target " + targetValue;
  } else if (step === 1) {
    // Target is greater than mid, search right half
    leftIndex = midIndex + 1;
    midIndex = Math.floor((leftIndex + rightIndex) / 2);
    message = "Target > mid value, searching right half";
  } else if (step === 2) {
    // Target is greater than mid, continue searching right half
    leftIndex = midIndex + 1;
    
    if (leftIndex > rightIndex) {
      message = "Search interval is now empty";
      animationState = "notFound";
    } else {
      midIndex = Math.floor((leftIndex + rightIndex) / 2);
      
      if (sortedArray[midIndex] === targetValue) {
        message = "Target found at index " + midIndex + "!";
        animationState = "found";
      } else {
        message = "Continuing to shrink the search interval";
      }
    }
  }
  
  // Draw the search interval label
  textSize(18);
  fill(200, 200, 255);
  text("Current search interval: [" + leftIndex + ", " + rightIndex + "]", width/2, height - 150);
}

function drawFoundMessage() {
  // Glowing effect for found message
  let glowIntensity = 150 + sin(frameCount * 0.1) * 50;
  
  fill(100, 255, 100, glowIntensity);
  textSize(28);
  textAlign(CENTER);
  text("Target Found at index " + midIndex + "!", width/2, height - 60);
  
  // Highlight the found element
  let boxWidth = 50;
  let startX = width/2 - (sortedArray.length * boxWidth)/2;
  let startY = height/2 - 50;
  
  noFill();
  strokeWeight(3);
  stroke(0, 255, 0, 150 + sin(frameCount * 0.2) * 100);
  rect(startX + midIndex * boxWidth - 5, startY - 5, boxWidth + 10, 50);
}

function drawNotFoundMessage() {
  fill(255, 100, 100);
  textSize(28);
  textAlign(CENTER);
  text("Target Not Found - Empty Interval", width/2, height - 60);
  
  textSize(18);
  fill(200, 200, 200);
  text("The search interval has shrunk to nothing", width/2, height - 30);
}
    </script>
  </body>
</html>